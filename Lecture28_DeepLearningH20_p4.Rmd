---
title: "Lecture 28 - Into Deep Learning P4"
output:
  html_document: default
  html_notebook: default
  pdf_document: default
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook


### Lecture 28 - Your project. Deep Learning with H2O. P.4 Implement Deep Learning Model to ShinyApp

Deep Learning... This lecture is dedicated to the implementation of Deep Learning models into for our Data

#### Work overview (from previous lectures)

* Review App
* Reverse Engineer
* Recommendations
* Template to train NN models

#### Review the App

Open Scripts ui.R, server.R and global.R. Run the App...

#### Reverse Engineer

Follow the R scripts and below diagram to find elements of the ShinyApp

![Architecture][id1]

#### AI Project recommendations

Below are some of my personal recommendations:

* Learn Deep Learning model by starting from provided template. Increase/decrease complexity of the model and monitor MSE score. Choose the one that less complex with reasonably low MSE score
* Start simple and small having greater idea in mind. Provide useful tool which can allow you to collect information for more complex AI project, then deliver even greater value for business
* Always be ready to present your work. You need to prove your value for business at any time. 



#### General Template to Train Models

```{r, eval=FALSE, include=TRUE}
library(tidyverse)
library(plotly)
library(h2o)
# ============= READ DATA =================
# Read our small data ... 
DF_Data_Recent <- readRDS("DF_Data_Process_Recent.data") 

DF_Equipm <- read_csv("DF_EquipmData.csv")
# data frame containing Event Names
DF_EvCode <- read_csv("DF_EvCodeDataProject.csv")

# Data manipulation and saving to the DF_TEMP
DF_TEMP <- DF_Data_Recent %>% 
  # join to decode equipment serial number
  inner_join(DF_Equipm, by = "IDEquipment") %>% 
  # join to decode Event Code meaning
  inner_join(DF_EvCode, by = "EventCode") %>% 
  # select only column needed
  select(StartDate, Name, AnalogVal, EventText)

# Visualize
DF_TEMP %>% 
  filter(EventText == "Tubing Process, phase angle") %>% 
  ggplot(aes(x = StartDate, y = AnalogVal, col = Name)) + geom_point()+facet_grid(~Name)

```

```{r, eval=FALSE, include=TRUE}
# Choose best machine to train model - Machine 1 (Domain Knowldege), extract data
# "Tubing Process, Phase"
DF_TEMP_TPA <- DF_TEMP %>% 
  filter(EventText == "Tubing Process, phase angle") %>% 
  filter(Name == "Machine #1") %>% 
  select(StartDate, AnalogVal) %>% 
  arrange(StartDate)

# transform to 2 matrixes
source("to_matrix.R")
source("to_matrixDT.R")

DF_M1 <- to_m(DF_TEMP_TPA, 150)
DF_M1t<- to_mDT(DF_TEMP_TPA, 150)

```

```{r, eval=FALSE, include=TRUE}
# to initialize the 'machine'
localH2O = h2o.init()

train_M1 <- as.h2o(x = DF_M1, destination_frame = "train_M1")

normality_model <- h2o.deeplearning(
 x = names(train_M1), 
 training_frame = train_M1, 
 activation = "Tanh", 
 autoencoder = TRUE, 
 hidden = c(50,20,50), 
 sparse = TRUE,
 l1 = 1e-4, 
 epochs = 100)

# computer error of the model
h2o.anomaly(normality_model, train_M1) %>% as.data.frame() %>% plot.ts(ylim = c(0, 10), type = "p")

# save model
h2o.saveModel(normality_model, "www/tmp/normality_model.bin")

# shutdown
h2o.shutdown(prompt = F)
```



[id1]: Architecture.PNG "Defined App Aproach"

