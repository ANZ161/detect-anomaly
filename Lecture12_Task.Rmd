---
title: "Lecture 12 - Homework"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook

### Lecture 12 - More ideas for ShinyApp server.R Data Import

#### Import data from SQL Database

In this example implementation is given using RODBC package. Implementation is consisting of two parts:

1. Creating a dedicated function that will
  a. establish the connection providing credentials
  b. construct query request
  c. send the query to the connection and retrieve the result
  d. close the connection
  e. return the result of the function 
2. Using this function in the script to actually call the data

As you can see there should be everything prepared on the SQL side. For example we have to have already a working table with data populated.

```r
library(RODBC)

# function that connects to SQL and return DF object
getDataFromSQL <- function(wrkTableName, connection = "NameConnectionODBC", userID = "SQLUserID", passID = "Password"){

  ch2<-odbcConnect(connection,uid = userID,pwd=passID)
  if(ch2 == -1){
    print("Error: connection was not established")

  }else{
    # Contruct SQL request
    sql.request2 <- paste("SELECT * FROM", wrkTableName)
    # Contruct SQL request and get data
    res2 <- as.data.frame(sqlQuery(ch2, sql.request2))
    odbcClose(ch2)
    return(res2)
  }
}

# --------
# importing data (code will be run once)
##
# data frame containing flow information
DF_Data <- getDataFromSQL("DB_Name.dbo.WRK_DF_Data")
# data frame containing equipment information
DF_Equipm <- getDataFromSQL("DB_Name.dbo.WRK_DF_EquipmData")
# data frame containing Event Names
DF_EvCode <- getDataFromSQL("DB_Name.dbo.WRK_EvCodeData")
--------

```

#### Import data from the User...

To enable user entry data from file it's necessary to use `fileInput` function and `observeEvent` function on the server side

```r
# in ui.R
fileInput(inputId = "myTable", label = "Upload a csv file", multiple = F, accept = 'table/csv')

# in server.R NB: create folder "temp_data" in the file system of the project...
  ## ****** ---------------*******
  # Uploading data using the app
  observeEvent(input$myTable, {
    inFile <- input$myTable
    if (is.null(inFile))
      return()
    file.copy(inFile$datapath, file.path("temp_data", paste(Sys.time(), ".csv")))
  })
  ## ******---------------********
```

### Lecture 12 - More to Practice for ShinyApp server.R Data Import

This exercise will allow you to understand better how the file upload from the user work. Try to execute steps mentioned below on your home computer to understand the result...

* As you see in the code chunk just above we save the content of the file to the variable inFile: `inFile <- input$myTable`. Let us try to understand the structure of this element...

To do so I will modify the structure of the code as you will see below:

```r
# in ui.R
fileInput(inputId = "myTable", label = "Upload a csv file", multiple = F, accept = 'table/csv')

# in server.R NB: create folder "temp_data" in the file system of the project...
  ## ****** ---------------*******
  # Uploading data using the app
  observeEvent(input$myTable, {
    inFile <- input$myTable
    if (is.null(inFile))
      return()
    #save R object to file for further understanding
    saveRDS(inFile,file = "in.File")
    file.copy(inFile$datapath, file.path("temp_data", paste(Sys.time(), ".csv")))
  })
  ## ******---------------********
```

Once you will run your app now and try to load file you will get the object 'inFile' actually saved to the file directory of the project under the name of 'in.File' (you can specify any other name). The next step you may do is to simply run the following command in the console: `readRDS("in.File")`. This will give you the possibility to read the file and see the content in the console...






