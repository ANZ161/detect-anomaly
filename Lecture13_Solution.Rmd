---
title: "Lecture 13 - Data Manipulation Homework"
output:
  html_notebook: default
  html_document: default
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook
 

### Lecture 13 - your turn to manipulate data


```{r, include=FALSE}
library(tidyverse)
# data frame containing equipment information
DF_Equipm <- read_csv("DF_EquipmData.csv")
# data frame containing Event Names
DF_EvCode <- read_csv("DF_EvCodeData.csv")
```

#### Reduce waste

Can you come up with more efficient way to do the data manipulation and to achieve the same result? Try to use the code snippet below and do that differently... (do not alter the code that makes a plot)
Hint: are all the lines are really needed?

```{r, echo=TRUE, message=FALSE, warning=FALSE}
# Task: Try to optimize this code...


read_csv("DF_Data.csv") %>% 
  # join to decode equipment serial number
  inner_join(DF_Equipm, by = "IDEquipment") %>% 
  # select only column needed
  select(StartDateTime, Name, EventCode, TimeTotal) %>% 
  # join to decode Event Code meaning
  inner_join(DF_EvCode, by = "EventCode") %>% 
  # select only column needed
  select(StartDateTime, TimeTotal, Name, EventText) %>% 
  # arrange by date 
  arrange(StartDateTime) %>% 
  # make a plot
  ggplot(aes(x = StartDateTime, y = TimeTotal, col = EventText)) + geom_point()+
  facet_grid(Name~.)
```



```{r, eval=FALSE, include=TRUE}
# Solution: Arrange and extra select is not really needed...

read_csv("DF_Data.csv") %>% 
  # join to decode equipment serial number
  inner_join(DF_Equipm, by = "IDEquipment") %>% 
  # join to decode Event Code meaning
  inner_join(DF_EvCode, by = "EventCode") %>% 
  # select only column needed
  select(StartDateTime, TimeTotal, Name, EventText) %>% 
  # make a plot
  ggplot(aes(x = StartDateTime, y = TimeTotal, col = EventText)) + geom_point()+
  facet_grid(Name~.)
```

#### Calculation on the go...

Can you convert the TimeTotal metric from seconds to minutes? 

Hint: Use function `?mutate()` <https://www.rdocumentation.org/packages/dplyr/versions/0.7.3/topics/mutate>

```{r, eval=FALSE, include=TRUE}
read_csv("DF_Data.csv") %>% 
  mutate(TimeTotal = TimeTotal/60) %>% 
  # join to decode equipment serial number
  inner_join(DF_Equipm, by = "IDEquipment") %>% 
  # join to decode Event Code meaning
  inner_join(DF_EvCode, by = "EventCode") %>% 
  # select only column needed
  select(StartDateTime, TimeTotal, Name, EventText) %>% 
  # make a plot
  ggplot(aes(x = StartDateTime, y = TimeTotal, col = EventText)) + geom_point()+
  facet_grid(Name~.)
```

#### Can you take a challenge? //Group by & summarise

Can you calculate min, max, average time, for each step and each machine (in minutes)?

```{r, eval=FALSE, warning=FALSE, include=TRUE}
read_csv("DF_Data.csv") %>% 
  tbl_df() %>% 
  mutate(TimeTotal = TimeTotal/60) %>% 
  # join to decode equipment serial number
  inner_join(DF_Equipm, by = "IDEquipment") %>% 
  # join to decode Event Code meaning
  inner_join(DF_EvCode, by = "EventCode") %>% 
  # select only column needed
  select(TimeTotal, Name, EventText) %>% 
  # group by machine
  group_by(Name, EventText) %>% 
  # summarise
  summarise(MinTime = min(TimeTotal), 
            AvgTime = mean(TimeTotal),
            MaxTime = max(TimeTotal))
```
